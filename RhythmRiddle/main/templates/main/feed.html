{% extends 'main/layout.html' %}
{% load static %}
{% block extrastyles %}
    <link rel="stylesheet" href="{% static 'start/css/index.css' %}">
    <link rel="stylesheet" href="{% static 'main/css/song_label.css' %}">
    <link rel="stylesheet" href="{% static 'main/css/modal.css' %}">
    <script src="https://unpkg.com/wavesurfer.js"></script>
{% endblock %}
{% block content %}
    <div class="feed">
        <section class="highlight">
            <div class="highlight-image">
                {% if song and song.cover %}
                    <img src="{{ song.cover.url }}" alt="–õ—É—á—à–µ–µ –∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü">
                {% else %}
                    <img src="{#}" alt="–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
                {% endif %}
            </div>
            <div class="highlight-info">
    <h1>–õ—É—á—à–µ–µ –∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü</h1>
    <h2>{{ song.title|default:"–ù–µ—Ç –ø–µ—Å–Ω–∏" }}</h2>
    <p>{{ song.artist|default:"–ù–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è" }}</p>
    <span class="popular-play-count">{{ song.play_count|default:0 }} –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π</span>

    {% if song %}
        <div class="highlight-player">
            <button class="play-highlight"
                    data-audio="{{ song.file.url }}"
                    data-title="{{ song.title }}"
                    data-artist="{{ song.artist }}">
                ‚ñ∂
            </button>

        </div>
                <script>document.addEventListener("DOMContentLoaded", () => {
    const player = WaveSurfer.create({
        container: document.createElement("div"), // –ë–µ–∑ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ–ª–Ω—ã
        waveColor: "#ddd",
        progressColor: "#007bff",
        responsive: true,
        hideScrollbar: true,
        height: 0,
    });

    // –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–µ–µ—Ä–æ–º
    const playPauseButton = document.getElementById("play-pause");
    const muteButton = document.getElementById("mute-unmute");
    const progressBar = document.getElementById("progress-bar");
    const volumeBar = document.getElementById("volume-bar");
    const currentTimeDisplay = document.getElementById("current-time");
    const durationDisplay = document.getElementById("duration");
    const trackTitle = document.getElementById("track-title");
    const currentTrackElement = document.getElementById("currentTrack");

    let currentTrack = null;

    // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
    function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${minutes}:${secs < 10 ? "0" : ""}${secs}`;
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–∞
    function loadTrack(audioSrc, title, artist) {
        if (currentTrack === audioSrc) {
            player.playPause(); // –ï—Å–ª–∏ —Ç–æ—Ç –∂–µ —Ç—Ä–µ–∫, —Å—Ç–∞–≤–∏–º play/pause
        } else {
            currentTrack = audioSrc;
            player.load(audioSrc);
            currentTrackElement.textContent = `${title} - ${artist}`;
            trackTitle.textContent = title;
        }
        if (currentTrack && currentTrack !== audioSrc) {
            player.stop(); // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
            playPauseButton.textContent = "Play"; // –°–±—Ä–æ—Å–∏—Ç—å –∫–Ω–æ–ø–∫—É
        }
        if (currentTrack && currentTrack !== audioSrc) {
            player.stop(); // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
            playPauseButton.textContent = "Play"; // –°–±—Ä–æ—Å–∏—Ç—å –∫–Ω–æ–ø–∫—É
        }
    }


    // –°–æ–±—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–∫–∞
    player.on("ready", () => {
        durationDisplay.textContent = formatTime(player.getDuration());
        progressBar.value = 0;
        progressBar.max = player.getDuration();
        player.play();
        playPauseButton.textContent = "Pause";
    });

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    player.on("audioprocess", () => {
        const currentTime = player.getCurrentTime();
        currentTimeDisplay.textContent = formatTime(currentTime);
        progressBar.value = currentTime;
    });

    // –û–∫–æ–Ω—á–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞
    player.on("finish", () => {
        playPauseButton.textContent = "Play";
        progressBar.value = 0;
        currentTimeDisplay.textContent = "0:00";
    });

    // Play/Pause
    playPauseButton.addEventListener("click", () => {
        player.playPause();
        playPauseButton.textContent = player.isPlaying() ? "Pause" : "Play";
    });

    // Mute/Unmute
    muteButton.addEventListener("click", () => {
        player.toggleMute();
        muteButton.textContent = player.getMute() ? "Unmute" : "Mute";
    });

    // –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
    progressBar.addEventListener("input", (e) => {
        const time = parseFloat(e.target.value);
        player.seekTo(time / player.getDuration());
    });

    // –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
    volumeBar.addEventListener("input", (e) => {
        player.setVolume(e.target.value);
    });


    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Ç—Ä–µ–∫–∞–º –∏–∑ highlights
    const highlightPlayButton = document.querySelector(".play-highlight");
    if (highlightPlayButton) {
        highlightPlayButton.addEventListener("click", () => {
            const audioSrc = highlightPlayButton.getAttribute("data-audio");
            const title = highlightPlayButton.getAttribute("data-title");
            const artist = highlightPlayButton.getAttribute("data-artist");
            loadTrack(audioSrc, title, artist);
        });
    }
});
</script>

</div>

                        <!--<script src="https://cdn.jsdelivr.net/npm/wavesurfer.js@7/dist/wavesurfer.esm.js"></script>
                        <script src="{% static 'main/js/script-audio.js' %}"></script> -->
                                    <!--<div class="custom-audio-player">
                        <audio id="audio-{{ song.id }}" src="{{ song.file.url }}"></audio>
                        <button class="play-pause-btn" data-id="{{ song.id }}">‚ñ∂</button>
                        <input type="range" class="progress-bar" data-id="{{ song.id }}" value="0" step="0.1">
                        <span class="current-time">0:00</span> / <span class="duration">0:00</span>
                        <input type="range" class="volume-control" data-id="{{ song.id }}" min="0" max="1" step="0.001" value="1">

                    </div>

                        <script src="{% static 'main/js/script-audio2.js' %}"></script> -->

                <style>


    </style>
</head>
<body>
    <div id="audio-player" class="audio-player" >
        <span id="currentTrack"></span>
        <button id="play-pause">Play</button>
        <span id="current-time">0:00</span>
        <input type="range" id="progress-bar" min="0" max="100" value="0">
        <span id="duration">0:00</span>
        <button id="mute-unmute">Mute</button>
        <input type="range" id="volume-bar" min="0" max="1" step="0.001" value="1">
        <div id="track-title">Track Title</div>
    </div>


    <script src="https://unpkg.com/wavesurfer.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
        const player = WaveSurfer.create({
            container: document.createElement("div"), // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞
            waveColor: "#ddd",
            progressColor: "#007bff",
            responsive: true,
            hideScrollbar: true,
            height: 0,
        });

        // –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        const playPauseButton = document.getElementById("play-pause");
        const muteButton = document.getElementById("mute-unmute");
        const progressBar = document.getElementById("progress-bar");
        const volumeBar = document.getElementById("volume-bar");
        const currentTimeDisplay = document.getElementById("current-time");
        const durationDisplay = document.getElementById("duration");
        const trackTitle = document.getElementById("track-title");
        const currentTrackElement = document.getElementById("currentTrack");

        // –ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        let currentTrack = null;

        // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? "0" : ""}${secs}`;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–∞
        function loadTrack(audioSrc, title) {
            if (currentTrack === audioSrc) {
                player.playPause(); // –ï—Å–ª–∏ —Ç–æ—Ç –∂–µ —Ç—Ä–µ–∫, —Å—Ç–∞–≤–∏–º play/pause
            } else {
                currentTrack = audioSrc;
                player.load(audioSrc);
                currentTrackElement.textContent = title;
                trackTitle.textContent = title;

            }
        }

        // –°–æ–±—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–∫–∞
        player.on("ready", () => {
            durationDisplay.textContent = formatTime(player.getDuration());
            progressBar.value = 0;
            progressBar.max = player.getDuration();
            player.play();
            playPauseButton.textContent = "Pause";
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        player.on("audioprocess", () => {
            const currentTime = player.getCurrentTime();
            currentTimeDisplay.textContent = formatTime(currentTime);
            progressBar.value = currentTime;
        });

        // –û–∫–æ–Ω—á–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞
        player.on("finish", () => {
            playPauseButton.textContent = "Play";
            progressBar.value = 0;
            currentTimeDisplay.textContent = "0:00";
        });

        // Play/Pause
        playPauseButton.addEventListener("click", () => {
            player.playPause();
            playPauseButton.textContent = player.isPlaying() ? "Pause" : "Play";
            console.log(player)
        });

        // Mute/Unmute
        muteButton.addEventListener("click", () => {
            player.toggleMute();
            muteButton.textContent = player.getMute() ? "Unmute" : "Mute";
        });

        // –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
        progressBar.addEventListener("input", (e) => {
            const time = parseFloat(e.target.value);
            player.seekTo(time / player.getDuration());
        });

        // –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        volumeBar.addEventListener("input", (e) => {
            player.setVolume(e.target.value);
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Ç—Ä–µ–∫–∞–º
        document.querySelectorAll(".track").forEach((trackElement) => {
            trackElement.addEventListener("click", () => {
                const audioSrc = trackElement.getAttribute("data-audio");
                const title = trackElement.getAttribute("data-title");
                loadTrack(audioSrc, title);
            });
        });
    });
    </script>


                    <!--<title>WaveSurfer Audio Player</title>
    <style>


        .audio-player {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }



        .audio-player .volume-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .audio-player .volume-slider {
            width: 150px;
            -webkit-appearance: none;
            height: 6px;
            background: #ddd;
            border-radius: 5px;
            outline: none;
        }

        .audio-player .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            background: #007BFF;
            border-radius: 50%;
            cursor: pointer;
        }

        .audio-player .mute-btn {
            font-size: 14px;
            padding: 5px 10px;
            background: #ff3b3b;
            color: white;
        }

        .audio-player .mute-btn:hover {
            background: #c70000;
        }

        .audio-player .progress-container {
            width: 100%;
            max-width: 300px;
            position: relative;
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .audio-player .progress-bar {
            width: 0;
            height: 100%;
            background: #007BFF;
            border-radius: 4px;
            transition: width 0.1s ease;
        }

        .audio-player .time {
            font-size: 14px;
            color: #555;
        }
    </style>

    <div class="audio-player">
        <button id="play-pause">‚ñ∂</button>
        <div class="progress-container">
            <div class="progress-bar"></div>
        </div>
        <div class="time">
            <span id="current-time">0:00</span> / <span id="duration">0:00</span>
        </div>
        <div class="volume-controls">
            <input type="range" id="volume-slider" class="volume-slider" min="0" max="1" step="0.01" value="0.5">
            <button id="mute-btn" class="mute-btn">üîá Mute</button>
        </div>
    </div>


    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WaveSurfer
        const wavesurfer = WaveSurfer.create({
            container: document.createElement('div'), // –ë–µ–∑ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ–ª–Ω—ã
            backend: 'MediaElement',
            mediaControls: false, // –£–±–∏—Ä–∞–µ–º –±–∞–∑–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        });

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞—É–¥–∏–æ—Ñ–∞–π–ª
        wavesurfer.load(`{{ song.file.url }}`);

        // –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        const playPauseBtn = document.getElementById('play-pause');
        const volumeSlider = document.getElementById('volume-slider');
        const muteBtn = document.getElementById('mute-btn');
        const progressBar = document.querySelector('.progress-bar');
        const progressContainer = document.querySelector('.progress-container');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');

        // Play/Pause —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
        playPauseBtn.addEventListener('click', () => {
            if (wavesurfer.isPlaying()) {
                wavesurfer.pause();
                playPauseBtn.textContent = '‚ñ∂';
            } else {
                wavesurfer.play();
                playPauseBtn.textContent = '‚è∏ ';
            }
        });

        // –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        volumeSlider.addEventListener('input', () => {
            wavesurfer.setVolume(volumeSlider.value);
        });

        // –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞
        muteBtn.addEventListener('click', () => {
            if (wavesurfer.getVolume() > 0) {
                wavesurfer.setVolume(0);
                muteBtn.textContent = 'üîä Unmute';
                volumeSlider.value = 0;
            } else {
                wavesurfer.setVolume(0.5);
                muteBtn.textContent = 'üîá Mute';
                volumeSlider.value = 0.5;
            }
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        wavesurfer.on('audioprocess', () => {
            const currentTime = wavesurfer.getCurrentTime();
            const duration = wavesurfer.getDuration();
            const progressPercent = (currentTime / duration) * 100;

            progressBar.style.width = `${progressPercent}%`;

            currentTimeEl.textContent = formatTime(currentTime);
            durationEl.textContent = formatTime(duration);
        });

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
        progressContainer.addEventListener('click', (e) => {
            const width = progressContainer.offsetWidth;
            const clickX = e.offsetX;
            const duration = wavesurfer.getDuration();

            wavesurfer.seekTo(clickX / width);
        });

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function formatTime(time) {
            const minutes = Math.floor(time / 60);
            const seconds = Math.floor(time % 60).toString().padStart(2, '0');
            return `${minutes}:${seconds}`;
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        wavesurfer.setVolume(0.5);
    </script> -->


                    </div>
                    <form action="{% url 'add_favorite' song.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="add-favorite-btn-2">‚ù§Ô∏é</button>
                    </form>

                {% endif %}
            </div>

        </section>

        <section class="quick-picks">
            <div>
                {% if quick_picks %}
                    <section class="quick-picks">
                        <h3>–ë—ã—Å—Ç—Ä–∞—è –≤—ã–±–æ—Ä–∫–∞</h3>
                        <div class="track-list">
    {% for song in quick_picks %}
        <div class="track"
             data-audio="{{ song.file.url }}"
             data-title="{{ song.title }}"
             data-artist="{{ song.artist }}">
            {% if song.cover %}
                <img src="{{ song.cover.url }}" alt="–û–±–ª–æ–∂–∫–∞ {{ song.title }}" class="song-cover">
            {% endif %}
            <div class="song-info">
                <h4>{{ song.title }}</h4>
                <span>{{ song.artist }}</span>
            </div>
        </div>
    {% empty %}
        <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–µ—Å–µ–Ω –¥–ª—è –≤—ã–±–æ—Ä–∞.</p>
    {% endfor %}
</div>
                        <div class="song-list">
                            <!--{% for song in quick_picks %}
                                <div class="song-item">
                                    {% if song.cover %}
                                        <img src="{{ song.cover.url }}" alt="–û–±–ª–æ–∂–∫–∞ {{ song.title }}" class="song-cover">
                                    {% endif %}
                                    <div class="song-info">
                                        <h4>{{ song.title }}</h4>
                                        <span>{{ song.artist }}</span><br>
                                        <audio controls>
                                            <source src="{{ song.file.url }}" type="audio/mpeg">
                                        </audio>
                                        <form action="{% url 'add_favorite' song.id %}" method="post">
                                            {% csrf_token %}
                                            <button type="submit" class="add-favorite-btn-1">–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
                                        </form>
                                    </div>
                                </div>
                            {% empty %}
                                <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–µ—Å–µ–Ω –¥–ª—è –≤—ã–±–æ—Ä–∞.</p>
                            {% endfor %} -->
                        </div>
                    </section>
                {% else %}
                    <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–µ—Å–µ–Ω.</p>
                {% endif %}
            </div>
        </section>

        <section class="shared-playlists">
            <div class="shared-playlists1">
                <h3>–û–±—â–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã</h3>
                    <div class="playlist-list">
                        {% if shared_playlists %}
                            {% for playlist in shared_playlists %}
                                <div class="playlist-item">
                                    <a href="{% url 'playlist_detail' playlist.id %}">
                                        <img style="width: 100%" src="{{ playlist.cover.url }}" alt="–û–±–ª–æ–∂–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞ {{ playlist.title }}">
                                    </a>
                                    <div class="playlist-info">
                                        <h4>{{ playlist.title }}</h4>
                                        <span>–ê–≤—Ç–æ—Ä: {{ playlist.owner.username }}</span>
                                    </div>
                                </div>
                            {% empty %}
                                <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—â–∏—Ö –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤.</p>
                            {% endfor %}
                        {% else %}
                            <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—â–∏—Ö –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤.</p>
                        {% endif %}
                    </div>
            </div>
        </section>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function() {
                $('.song-item audio').on('play', function() {
                    const songId = $(this).closest('.song-info').find('form').attr('action').split('/').slice(-2, -1)[0];

                    $.ajax({
                        url: "{% url 'increment_play_count' 0 %}".replace('0', songId),
                        method: 'POST',
                        data: {
                            'csrfmiddlewaretoken': '{{ csrf_token }}'
                        },
                    });
                });

                $('audio').on('play', function() {
                    if ($(this).closest('.highlight-info').length > 0) {
                        const songId = "{{ song.id }}";

                        $.ajax({
                            url: "{% url 'increment_play_count' 0 %}".replace('0', songId),
                            method: 'POST',
                            data: {
                                'csrfmiddlewaretoken': '{{ csrf_token }}'
                            },
                        });
                    }
                });
            });
        </script>

        {% if stats.first_user_genre is None %}
            <div id="genreModal" class="modal">
                <div class="modal-content">
                    <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∂–∞–Ω—Ä</h2>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∂–∞–Ω—Ä. –ú–∞–∫—Å–∏–º—É–º –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç—Ä–∏.</p>
                    <div id="genreSelection">
                        {% for genre, genre_display in stats.USERS_GENRE %}
                            <div class="genre-placeholder" data-genre="{{ genre }}">{{ genre_display }}</div>
                        {% endfor %}
                    </div>
                    <button id="doneButton">–ì–æ—Ç–æ–≤–æ</button>
                </div>
            </div>

            <script>
                document.getElementById('genreModal').style.display = "block";

                let selectedGenres = [];

                document.querySelectorAll('.genre-placeholder').forEach(function(element) {
                    element.addEventListener('click', function() {
                        const genre = this.getAttribute('data-genre');
                        if (selectedGenres.includes(genre)) {
                            selectedGenres = selectedGenres.filter(item => item !== genre);
                            this.classList.remove('selected');
                        } else {
                            if (selectedGenres.length < 3) {
                                selectedGenres.push(genre);
                                this.classList.add('selected');
                            }
                        }
                    });
                });

                document.getElementById('doneButton').addEventListener('click', function() {
                    const csrftoken = '{{ csrf_token }}';
                    fetch('{% url "update_genres" %}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrftoken,
                        },
                        body: JSON.stringify({ genres: selectedGenres })
                    }).then(() => location.reload());
                });
            </script>
        {% endif %}
    </div>
{% endblock %}
